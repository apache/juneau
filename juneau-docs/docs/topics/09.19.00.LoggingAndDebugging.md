---
title: "Logging / Debugging"
slug: RestServerLoggingAndDebugging
---

The REST APIs provides supports enabling logging of HTTP requests and responses through the following annotations:

<tree>
<node-0><java-annotation><a href="/site/apidocs/org/apache/juneau/rest/annotation/Rest.html" target="_blank">Rest</a></java-annotation></node-0>
<node-1><java-method-annotation><a href="/site/apidocs/org/apache/juneau/rest/annotation/Rest.html#debug()" target="_blank">debug</a></java-method-annotation></node-1>
<node-1><java-method-annotation><a href="/site/apidocs/org/apache/juneau/rest/annotation/Rest.html#debugOn()" target="_blank">debugOn</a></java-method-annotation></node-1>
<node-0><java-annotation><a href="/site/apidocs/org/apache/juneau/rest/annotation/RestOp.html" target="_blank">RestOp</a></java-annotation></node-0>
<node-1><java-method-annotation><a href="/site/apidocs/org/apache/juneau/rest/annotation/RestOp.html#debug()" target="_blank">debug</a></java-method-annotation></node-1>
</tree>

Debug mode enables the following:

- HTTP request/response bodies are cached in memory for logging purposes.
- HTTP requests/responses are logged to the registered <a href="/site/apidocs/org/apache/juneau/rest/logger/CallLogger.html" target="_blank">CallLogger</a>.

The possible annotation values are:

- `true` - Debug is enabled for all requests.
- `false` - Debug is disabled for all requests.
- `conditional` - Debug is enabled only for requests that have a `Debug: true` header.

:::tip Example
```java
// Enable debugging on all op calls on this resource
@Rest(debug="true")
public class MyResource {...}
```
:::

These annotations support SVL variables, so it's possible to define them as a system property for example.

```java
// Enable via system property 'MyResource.debug'
@Rest(debug="$S{MyResource.debug}")
public class MyResource {...}
```

The <a href="/site/apidocs/org/apache/juneau/rest/annotation/Rest.html#debugOn()" target="_blank">@Rest(debugOn)</a> annotation can also be used to
enable debugging.
It takes a comma-delimited list of key-value pairs, the keys being class or method names, and the values being one of `true|false|conditional`.

```java
// Turn on debug per-request on the class and always on the doX() method
@Rest(debugOn="MyResource=conditional,MyResource.doX=true")
public class MyResource {...}
```

The primary advantage of <a href="/site/apidocs/org/apache/juneau/rest/annotation/Rest.html#debugOn()" target="_blank">@Rest(debugOn)</a> is that
you can control debugging externally such as through a system property or environment variable:

```java
// Turn on debug per-request on the class and always on the doX() method
@Rest(debugOn="$E{DEBUG}")
public class MyResource {...}
```

Debugging can also be enabled programmatically with the use of the following APIs:

<tree>
<node-0><java-class><a href="/site/apidocs/org/apache/juneau/rest/debug/DebugEnablement.html" target="_blank">DebugEnablement</a></java-class></node-0>
<node-1><javac-class><a href="/site/apidocs/org/apache/juneau/rest/debug/BasicDebugEnablement.html" target="_blank">BasicDebugEnablement</a></javac-class></node-1>
<node-0><java-class><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html" target="_blank">RestContext.Builder</a></java-class></node-0>
<node-1><javac-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#debugEnablement()" target="_blank">debugEnablement()</a></javac-method> <javac-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#debugEnablement(java.lang.Class)" target="_blank">debugEnablement(Class)</a></javac-method> <javac-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#debugEnablement(org.apache.juneau.rest.debug.DebugEnablement)" target="_blank">debugEnablement(DebugEnablement)</a></javac-method></node-1>
</tree>

HTTP calls can be logged with the following levels of granularity:

<tree>
<node-0><java-class><a href="/site/apidocs/org/apache/juneau/rest/logger/CallLoggingDetail.html" target="_blank">CallLoggingDetail</a></java-class></node-0>
<node-1><javac-field><a href="/site/apidocs/org/apache/juneau/rest/logger/CallLoggingDetail.html#STATUS_LINE" target="_blank">STATUS_LINE</a></javac-field> <javac-field><a href="/site/apidocs/org/apache/juneau/rest/logger/CallLoggingDetail.html#HEADER" target="_blank">HEADER</a></javac-field> <javac-field><a href="/site/apidocs/org/apache/juneau/rest/logger/CallLoggingDetail.html#ENTITY" target="_blank">ENTITY</a></javac-field></node-1>
</tree>


The following examples show the output format for each detail type:

#### STATUS_LINE

```text
WARNING: [500] HTTP POST /foo?foo=bar
```

#### HEADER

```text
WARNING:
=== HTTP Call (incoming) ===================================================
[500] HTTP POST /foo?foo=bar
    Request length: 3 bytes
    Response code: 500
    Response length: 3 bytes
    Exec time: 20ms
---Request Headers---
    Foo: bar
---Response Headers---
    Foo: bar
    `Content-Type: text/plain`
=== END ===================================================================
```

#### ENTITY

```text
WARNING:
=== HTTP Call (incoming) ===================================================
[500] HTTP POST /foo?foo=bar
    Request length: 3 bytes
    Response code: 500
    Response length: 3 bytes
    Exec time: 20ms
---Request Headers---
    Foo: bar
---Response Headers---
    Foo: bar
    `Content-Type: text/plain`
---Request Content UTF-8---
Foo
---Request Content Hex---
46 6F 6F
---Response Content UTF-8---
Foo
---Response Content Hex---
46 6F 6F
=== END ===================================================================
```

The interface responsible for generating the log entries is <a href="/site/apidocs/org/apache/juneau/rest/logger/CallLogger.html" target="_blank">CallLogger</a> and the default is <a href="/site/apidocs/org/apache/juneau/rest/logger/BasicCallLogger.html" target="_blank">BasicCallLogger</a> which produces the output above.

It can be changed through any of the following:

<tree>
<node-0><java-annotation><a href="/site/apidocs/org/apache/juneau/rest/annotation/Rest.html" target="_blank">Rest</a></java-annotation></node-0>
<node-1><javac-method-annotation><a href="/site/apidocs/org/apache/juneau/rest/annotation/Rest.html#callLogger()" target="_blank">callLogger()</a></javac-method-annotation></node-1>
<node-0><java-class><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html" target="_blank">RestContext.Builder</a></java-class></node-0>
<node-1><javac-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#callLogger()" target="_blank">callLogger()</a></javac-method> <javac-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#callLogger(java.lang.Class)" target="_blank">callLogger(Class)</a></javac-method> <javac-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#callLogger(org.apache.juneau.rest.logger.CallLogger)" target="_blank">callLogger(CallLogger)</a></javac-method></node-1>
</tree>

The call logger uses logging rules to map requests to logging detail levels.

By default, these are the logging rules:

```java
RestLogger
    .create()
    .beanStore(beanStore)  // Allow injected beans in constructor
    .normalRules(  // Rules when debugging is not enabled
        RestLoggerRule.create()  // Log 500+ errors with status-line and header information
            .statusFilter(x -> x >= 500)
            .level(SEVERE)
            .requestDetail(HEADER)
            .responseDetail(HEADER)
            .build(),
        RestLoggerRule.create()  // Log 400-500 errors with just status-line information
            .statusFilter(x -> x >= 400)
            .level(WARNING)
            .requestDetail(STATUS_LINE)
            .responseDetail(STATUS_LINE)
            .build()
    )
    .debugRules(  // Rules when debugging is enabled
        RestLoggerRule.create()  // Log everything with full details
            .level(SEVERE)
            .requestDetail(ENTITY)
            .responseDetail(ENTITY)
            .build()
    );
```

Thrown exceptions get logged with a stack trace hash and a counter like below:

```text
WARNING: [500,9b85cc96.13] HTTP POST /foo?foo=bar
```

Stack trace hashes are controlled by the <a href="/site/apidocs/org/apache/juneau/rest/stats/ThrownStore.html" target="_blank">ThrownStore</a> bean
which is configured via the following:

<tree>
<node-0><java-class><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html" target="_blank">RestContext.Builder</a></java-class></node-0>
<node-1><java-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#thrownStore()" target="_blank">thrownStore()</a></java-method></node-1>
<node-1><java-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#thrownStore(java.lang.Class)" target="_blank">thrownStore(Class)</a></java-method></node-1>
<node-1><java-method><a href="/site/apidocs/org/apache/juneau/rest/RestContext.Builder.html#thrownStore(org.apache.juneau.rest.stats.ThrownStore)" target="_blank">thrownStore(ThrownStore)</a></java-method></node-1>
</tree>

:::note
- The <a href="/site/apidocs/org/apache/juneau/rest/logger/BasicTestCallLogger.html" target="_blank">BasicTestCallLogger</a> class is useful for testing and allows you to suppress logging when testing error conditions by passing in a `noTrace=true` query parameter or `No-Trace: true` header on requests.
- <a href="/site/apidocs/org/apache/juneau/rest/debug/DebugEnablement.html" target="_blank">DebugEnablement</a>, <a href="/site/apidocs/org/apache/juneau/rest/logger/CallLogger.html" target="_blank">CallLogger</a>, and <a href="/site/apidocs/org/apache/juneau/rest/stats/ThrownStore.html" target="_blank">ThrownStore</a> can all be defined globally as Spring beans in a Spring Boot environment.
:::

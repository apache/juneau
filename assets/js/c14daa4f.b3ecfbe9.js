"use strict";(self.webpackChunkjuneau_documentation=self.webpackChunkjuneau_documentation||[]).push([[7331],{10684:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"topics/10.14.04.AuthenticationOIDC","title":"OIDC Authentication","description":"The following example shows an implementation of a client that performs OIDC authentication against the IBM Jazz","source":"@site/docs-staging/topics/10.14.04.AuthenticationOIDC.md","sourceDirName":"topics","slug":"/topics/10.14.04.AuthenticationOIDC","permalink":"/docs/topics/10.14.04.AuthenticationOIDC","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/juneau/tree/main/juneau-docs-poc/juneau-documentation/docs-staging/topics/10.14.04.AuthenticationOIDC.md","tags":[],"version":"current","frontMatter":{"title":"OIDC Authentication"},"sidebar":"tutorialSidebar","previous":{"title":"10.14.3. Form-Based Authentication","permalink":"/docs/topics/10.14.03.AuthenticationForm"},"next":{"title":"11.1. juneau-rest-mock Basics","permalink":"/docs/topics/11.01.00.JuneauRestMockBasics"}}');var o=n(74848),a=n(28453);const r={title:"OIDC Authentication"},s=void 0,c={},d=[];function u(e){const t={code:"code",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"The following example shows an implementation of a client that performs OIDC authentication against the IBM Jazz\nplatform."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-java",children:'/**\n* Constructor.\n*/\npublic JazzRestClient.Builder(URI jazzUri, String user, String pw) throws IOException {\n    ...\n}\n\n/**\n* Override the createHttpClient() method to return an authenticated client.\n*/\n@Override /* RestClient.Builder */\nprotected CloseableHttpClient createHttpClient() throws Exception {\n    CloseableHttpClient client = super.createHttpClient();\n    oidcAuthenticate(client);\n    return client;\n}\n\nprivate void oidcAuthenticate(HttpClient client) throws IOException {\n\n    HttpGet request = new HttpGet(jazzUri);\n    request.setConfig(RequestConfig.custom().setRedirectsEnabled(false).build());\n\n    // Charset must explicitly be set to UTF-8 to handle user/pw with non-ascii characters.\n    request.addHeader("Content-Type", "application/x-www-form-urlencoded; charset=utf-8");\n\n    HttpResponse response = client.execute(request);\n    try {\n        int code = response.getStatusLine().getStatusCode();\n\n        // Already authenticated\n        if (code == SC_OK)\n            return;\n\n        if (code != SC_UNAUTHORIZED)\n            throw new RestCallException("Unexpected response during OIDC authentication: "\n                + response.getStatusLine());\n\n        // x-jsa-authorization-redirect\n        String redirectUri = getHeader(response, "X-JSA-AUTHORIZATION-REDIRECT");\n\n        if (redirectUri == null)\n            throw new RestCallException("Expected a redirect URI during OIDC authentication: "\n                + response.getStatusLine());\n\n        // Handle Bearer Challenge\n        HttpGet method = new HttpGet(redirectUri + "&prompt=none");\n        addDefaultOidcHeaders(method);\n\n        response = client.execute(method);\n\n        code = response.getStatusLine().getStatusCode();\n\n        if (code != SC_OK)\n            throw new RestCallException("Unexpected response during OIDC authentication phase 2: "\n                + response.getStatusLine());\n\n        String loginRequired = getHeader(response, "X-JSA-LOGIN-REQUIRED");\n\n        if (! "true".equals(loginRequired))\n            throw new RestCallException("X-JSA-LOGIN-REQUIRED header not found on response during OIDC authentication phase 2: "\n                + response.getStatusLine());\n\n        method = new HttpGet(redirectUri + "&prompt=none");\n\n        addDefaultOidcHeaders(method);\n        response = client.execute(method);\n\n        code = response.getStatusLine().getStatusCode();\n\n        if (code != SC_OK)\n            throw new RestCallException("Unexpected response during OIDC authentication phase 3: "\n                + response.getStatusLine());\n\n        // Handle JAS Challenge\n        method = new HttpGet(redirectUri);\n        addDefaultOidcHeaders(method);\n\n        response = client.execute(method);\n\n        code = response.getStatusLine().getStatusCode();\n\n        if (code != SC_OK)\n            throw new RestCallException("Unexpected response during OIDC authentication phase 4: "\n                + response.getStatusLine());\n\n        cookie = getHeader(response, "Set-Cookie");\n\n        Header[] defaultHeaders = new Header[] {\n            BasicStringHeader.of("User-Agent", "Jazz Native Client"),\n            BasicStringHeader.of("X-com-ibm-team-configuration-versions",\n                "com.ibm.team.rtc=6.0.0,com.ibm.team.jazz.foundation=6.0"),\n            BasicStringHeader.of("Accept", "text/json"),\n            BasicStringHeader.of("Authorization", "Basic "\n                + StringUtils.base64EncodeToString(user + ":" + pw)),\n\n            BasicStringHeader.of("Cookie", cookie)\n        };\n\n        setDefaultHeaders(AList.of(defaultHeaders));\n\n    } finally {\n        EntityUtils.consume(response.getEntity());\n    }\n}\n\nprivate void addDefaultOidcHeaders(HttpRequestBase method) {\n    method.addHeader("User-Agent", "Jazz Native Client");\n    method.addHeader("X-com-ibm-team-configuration-versions",\n        "com.ibm.team.rtc=6.0.0,com.ibm.team.jazz.foundation=6.0");\n    method.addHeader("Accept", "text/json");\n\n    if (cookie != null) {\n        method.addHeader("Authorization", "Basic "\n            + StringUtils.base64EncodeToString(user + ":" + pw));\n\n        method.addHeader("Cookie", cookie);\n    }\n}\n'})})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>s});var i=n(96540);const o={},a=i.createContext(o);function r(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);